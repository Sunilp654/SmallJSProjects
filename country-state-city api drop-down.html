<!DOCTYPE html>
<html lang="en">
<head>
   <title>Index</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <style>
  .loader {
    width: 100%;
    position: absolute;
    background: #000000bd;
    top: 0;
    right: 0;
    height: 100%;
    z-index: 99;
    display: flex;
    justify-content: center;
    color: #fff;
    align-items: center;
}
.loader h5{
font-size:32px;
}
  </style>
  
</head>
<body>

<div class="container">
<div class="loader" style="display:none;">
<h5>Loading...</h5>
</div>
  <div class="row">
  	<div class="col-md-4 mx-auto">
  		<div class="form-group">
      <label for="sel1">Select Country</label>
      <select class="form-control" id="sel1" name="sellist1" onchange="getvalue()">
      	<option>Select Country</option>
      </select>
    </div>
  	</div>
  	<div class="col-md-4 mx-auto">
  		<div class="form-group">
      <label for="sel2">Select State</label>
      <select class="form-control" id="sel2" name="sellist1" placeholder="Select State" onchange="send()">
      	<option selected>Select States</option>
      </select>
    </div>
  	</div>

  	<div class="col-md-4 mx-auto">
  		<div class="form-group">
      <label for="sel2">Select Cities</label>
      <select class="form-control" id="sel3" name="sellist1">
      	<option selected>Select Cities</option>
      	
      </select>
    </div>
  	</div>

  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script type="text/javascript">
	
$(document).ready(function () {  
$('.loader').show();
                $.ajax({  
                    type: "GET",  
                    url: "https://countriesnow.space/api/v0.1/countries/states",  
                    contentType: "application/json; charset=utf-8",  
                    dataType: "json",  
                    success: function (response) {
                    	var datal = response.data;
                    	//console.log(datal);
                    		for(i=0; datal.length > i; i++)
							{
								$("#sel1").append("<option>"+ datal[i].name +"</option>")
							}

                    		                     },  
                    failure: function (response) {  
                        alert(response.responseText);  
                        alert("Failure");  
                    },  
                    error: function (response) {  
                        alert(response);  
                        alert("Error");  
                    }  
                }).done(function(){
   $(".loader").hide();
});  
});
        
		 function getvalue(){
                 var value = $("#sel1").val();
				 $('.loader').show();
                 $.ajax({  
                    type: "GET",  
                    url: "https://countriesnow.space/api/v0.1/countries/states",  
                    contentType: "application/json; charset=utf-8",  
                    dataType: "json",  
                    success: function (response) {  
                    	var datalc = response.data;
                    	//console.log(datal);
                    	$("#sel2").empty();
                    	$("#sel3").empty();
                    	var html = "<option selected>Select Cities</option>";
               				$("#sel3").prepend(html);
                    		for(i=0; datalc.length > i; i++)
							{

								if($("#sel1").val() == datalc[i].name){

									for(j=0; datalc[i].states.length > j; j++){
										$("#sel2").append("<option>"+ datalc[i].states[j].name +"</option>")
									}
									
								}
								
							}
							var html = "<option selected>Select State</option>";
               				$("#sel2").prepend(html);
							
                    		                     },  
                    failure: function (response) {  
                        alert(response.responseText);  
                        alert("Failure");  
                    },  
                    error: function (response) {  
                        alert(response);  
                        alert("Error");  
                    }  
                }).done(function(){
   $(".loader").hide();
});  

                }
                function send() {
        var person = {
            country: $("#sel1").val(),
            state:$("#sel2").val()
        }
		$('.loader').show();

        $.ajax({
            url: 'https://countriesnow.space/api/v0.1/countries/state/cities',
            type: 'POST',
            dataType: 'json',
			data: JSON.stringify(person),
            contentType: 'application/json',
            success: function (response) {
                //$('#target').html(data.msg);
                $("#sel3").empty();
                var datafetch = response.data

                for(i=0; datafetch.length > i; i++)
							{
								$("#sel3").append("<option>"+ datafetch[i] +"</option>")
							}
							 var html = "<option selected>Select Cities</option>";
               				$("#sel3").prepend(html);
            }
            

           
        }).done(function(){
   $(".loader").hide();
});  
    }
</script>
</body>
</html>
